# Global options - use internal certs for local development
{
    local_certs
}

# Fernando Vargas Portfolio (main site + admin)
https://{$DOMAIN_FERNANDO:localhost} {
    tls internal

    # API and GraphQL routes to backend
    handle /graphql* {
        reverse_proxy backend:5000
    }

    handle /api/* {
        reverse_proxy backend:5000
    }

    handle /healthcheck {
        reverse_proxy backend:5000
    }

    # Everything else to frontend
    handle {
        reverse_proxy frontend-fernando:80
    }
}

# Jessica Sutherland Portfolio (photographer)
https://{$DOMAIN_JESSICA:jessica.localhost} {
    tls internal

    # Redirect /admin to main Fernando admin
    handle /admin* {
        redir https://{$DOMAIN_FERNANDO:localhost}{uri} permanent
    }

    # API and GraphQL routes to backend
    handle /graphql* {
        reverse_proxy backend:5000
    }

    handle /api/* {
        reverse_proxy backend:5000
    }

    handle /healthcheck {
        reverse_proxy backend:5000
    }

    # Everything else to frontend
    handle {
        reverse_proxy frontend-jessica:80
    }
}

# Busy Bee Marketing Agency Portfolio
https://{$DOMAIN_BUSYBEE:busybee.localhost} {
    tls internal

    # Redirect /admin to main Fernando admin
    handle /admin* {
        redir https://{$DOMAIN_FERNANDO:localhost}{uri} permanent
    }

    # API and GraphQL routes to backend
    handle /graphql* {
        reverse_proxy backend:5000
    }

    handle /api/* {
        reverse_proxy backend:5000
    }

    handle /healthcheck {
        reverse_proxy backend:5000
    }

    # Everything else to frontend
    handle {
        reverse_proxy frontend-busybee:80
    }
}
