# Global options - disable automatic HTTPS for local development
{
    auto_https off
}

# Fernando Vargas Portfolio (main site + admin)
http://{$DOMAIN_FERNANDO:localhost} {
    # API and GraphQL routes to backend
    handle /graphql* {
        reverse_proxy backend:5000
    }

    handle /api/* {
        reverse_proxy backend:5000
    }

    handle /healthcheck {
        reverse_proxy backend:5000
    }

    # Everything else to frontend
    handle {
        reverse_proxy frontend-fernando:80
    }
}

# Jessica Sutherland Portfolio (photographer)
http://{$DOMAIN_JESSICA:jessica.localhost} {
    # Redirect /admin to main Fernando admin
    handle /admin* {
        redir http://{$DOMAIN_FERNANDO:localhost}{uri} permanent
    }

    # API and GraphQL routes to backend
    handle /graphql* {
        reverse_proxy backend:5000
    }

    handle /api/* {
        reverse_proxy backend:5000
    }

    handle /healthcheck {
        reverse_proxy backend:5000
    }

    # Everything else to frontend
    handle {
        reverse_proxy frontend-jessica:80
    }
}

# Busy Bee Marketing Agency Portfolio
http://{$DOMAIN_BUSYBEE:busybee.localhost} {
    # Redirect /admin to main Fernando admin
    handle /admin* {
        redir http://{$DOMAIN_FERNANDO:localhost}{uri} permanent
    }

    # API and GraphQL routes to backend
    handle /graphql* {
        reverse_proxy backend:5000
    }

    handle /api/* {
        reverse_proxy backend:5000
    }

    handle /healthcheck {
        reverse_proxy backend:5000
    }

    # Everything else to frontend
    handle {
        reverse_proxy frontend-busybee:80
    }
}
